name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: 检出代码
      uses: actions/checkout@v4
    
    - name: 安装 uv
      uses: astral-sh/setup-uv@v4
      with:
        version: 0.8.18
    
    - name: 设置 Python
      run: uv python install 3.11
    
    - name: 安装依赖
      run: uv sync --all-extras
    
    - name: 运行测试
      run: uv run pytest

    # Skip type checking, formatting, and linting for initial release
    # - name: 运行类型检查
    #   run: uv run mypy src/
    # - name: 运行代码格式化检查
    #   run: |
    #     uv run black --check src/
    #     uv run isort --check-only src/
    # - name: 运行代码风格检查
    #   run: uv run flake8 src/

  # Skip security checks for initial release
  # security:
  #   runs-on: ubuntu-latest
  #   steps:
  #   - name: 检出代码
  #     uses: actions/checkout@v4
  #   - name: 安装 uv
  #     uses: astral-sh/setup-uv@v4
  #     with:
  #       version: 0.8.18
  #   - name: 设置 Python
  #     run: uv python install 3.11
  #   - name: 安装依赖
  #     run: uv sync --all-extras
  #   - name: 运行安全检查
  #     run: |
  #       uv run safety check
  #       uv run bandit -r src/